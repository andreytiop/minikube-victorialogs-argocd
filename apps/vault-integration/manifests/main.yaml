# SecretStore указывает ESO, как подключиться к Vault
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: vault-backend
  namespace: victoria-logs # Создаем в неймспейсе, где понадобится секрет
spec:
  provider:
    vault:
      server: "http://vault.vault.svc.cluster.local:8200"
      path: "kv"
      version: "v2"
      auth:
        tokenSecretRef:
          name: "vault-token"
          key: "token"
          namespace: "external-secrets" # <-- Указываем, где лежит секрет с токеном

---
# ExternalSecret описывает, какой секрет из Vault нужно синхронизировать
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: victorialogs-dummy-secret
  namespace: victoria-logs # В каком неймспейсе создать Kubernetes Secret
spec:
  refreshInterval: "15s"
  secretStoreRef:
    name: vault-backend
    kind: SecretStore
  target:
    name: victorialogs-dummy-secret-from-vault
    creationPolicy: Owner
  data:
  - secretKey: my-secret-key
    remoteRef:
      key: kv/apps/victorialogs
      property: dummy-key

